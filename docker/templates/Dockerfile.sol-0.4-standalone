# =============================================================================
# SOLIDITY 0.4.x STANDALONE TEMPLATE
# =============================================================================
# For old vulnerable contracts (pre-0.5.0) with no external dependencies
# Common in: Reentrancy examples, overflow bugs, old audits
#
# Build: docker build -t yudai-sol-0.4:latest -f docker/templates/Dockerfile.sol-0.4-standalone .
# Usage: Copy /templates/sol-0.4-standalone to workspace
# =============================================================================

FROM yudai-base:latest

LABEL template.name="sol-0.4-standalone"
LABEL template.solc="0.4.26"
LABEL template.dependencies="none"
LABEL template.use-case="Old vulnerable contracts (pre-0.5.0)"

# Set solc version for this template
RUN . /opt/venv-main/bin/activate && solc-select use 0.4.26

# Create template directory
WORKDIR /templates/sol-0.4-standalone

# Initialize Foundry project
RUN forge init --no-commit --no-git .

# Configure foundry.toml for Solidity 0.4.x
RUN cat > foundry.toml <<'EOF'
[profile.default]
src = "src"
out = "out"
libs = ["lib"]
solc = "0.4.26"

[profile.default.optimizer]
enabled = true
runs = 200

# Use istanbul EVM version for compatibility
evm_version = "istanbul"

# Disable strict mode for old Solidity
via_ir = false
EOF

# Create a sample contract to verify compilation
RUN cat > src/Sample.sol <<'EOF'
pragma solidity ^0.4.26;

contract Sample {
    uint256 public value;

    function setValue(uint256 _value) public {
        value = _value;
    }

    function getValue() public view returns (uint256) {
        return value;
    }
}
EOF

# Verify template compiles
RUN forge build && echo "âœ“ Template verified: sol-0.4-standalone"

# Clean build artifacts but keep lib/
RUN rm -rf out cache

# Create README for the template
RUN cat > README.md <<'EOF'
# Solidity 0.4.x Standalone Template

This template is configured for Solidity 0.4.26 contracts with no external dependencies.

## Usage

Copy this template to your workspace:
```bash
cp -r /templates/sol-0.4-standalone /workspace
```

## Configuration

- **Solidity Version**: 0.4.26
- **EVM Version**: istanbul
- **Dependencies**: None
- **Optimizer**: Enabled (200 runs)

## Common Issues

- **Constructor naming**: Use `function ContractName()` not `constructor()`
- **Visibility**: Public/external not required for state variables
- **SafeMath**: Not built-in, use OpenZeppelin or inline checks

## Testing

```bash
cd /workspace
forge build
forge test
```
EOF

WORKDIR /workspace
